---
title: "Seattle Crime Data from 2008 to Present"
author: "Ranch San Jose"
date: today
format: 
  html:
    embed-resources: true
execute:
  echo: true
---
## Loading the data and displaying the rows data
```{r}
# make sure to uncomment and install library
# install.packages("tidyverse")
```{r}

```

library(tidyverse)
crime_data <- read.csv("SPD_Crime_Data__2008-Present_20250228.csv")
crime_data 
```
## Filter only to Group A
```{r}
crime_data |>
  filter(Group.A.B == "A")
crime_data
# reduced from 1,175,457 to 1,098,690 rows
```

## Displaying the data in terms of columns
```{r}
eval = TRUE

colnames(crime_data)
```

## Summary of data
```{r}
crime_data |>
  summary()
```

## Cleaning the data
```{r}
# make sure to uncomment and install the libraries
# install.packages("lubridate")
# install.packages("plotly")

# check for missing values and it seems like there is none
colSums(is.na(crime_data))

# convert Report.DateTime to Date-Time format in R
library(lubridate)
crime_data$Report.DateTime <- mdy_hms(crime_data$Report.DateTime)

# checking structure of data
str(crime_data)
```

## Crime Frequency Over Time
```{r}
eval = TRUE

# make sure to uncomment and install the libraries
# install.packages("ggplot2")
# install.packages("dplyr")

library(ggplot2)
library(dplyr)
library(plotly)

# Create a new column where it only contains the date and not the time
crime_data <- crime_data |>
  mutate(Report.Date = as.Date(Report.DateTime))

# count crimes per day
crime_trends <- crime_data |>
  group_by(Report.Date) |>
  summarise(Crime_Count_Per_Day = n())


plot <- crime_trends |>
  ggplot(aes(x = Report.Date, y = Crime_Count_Per_Day)) +
  geom_line(color = "red") +
  labs(
    title = "Crime Trends Over Time from 2008 to Present",
    x = "Date (in years)",
    y = "Crime Count",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) +
  theme_minimal()
ggplotly(plot)
```

## Crime Patterns by Hour of Day
```{r}
eval = TRUE
library(plotly)
# extract the hour from Report.DateTime
crime_data$Hour <- hour(crime_data$Report.DateTime)

# create visualization for number of crimes per hour
plot <- crime_data |>
  ggplot(aes(x = Hour)) +
  geom_bar(fill = "orange") +
  labs(
    title = "Crime Frequency by Hour of the Day",
    x = "Hour",
    y = "Crime Count",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) +
  theme_minimal()

ggplotly(plot)
```

## Crime Trends by Day of the Week
```{r}
eval = TRUE

# extract day of the week
crime_data$DayOfWeek <- wday(crime_data$Report.DateTime, label = TRUE)

# create visualization by day of the week
plot <- crime_data |>
  ggplot(aes(x = DayOfWeek)) +
  geom_bar(fill = "purple") +
  labs(
    title = "Crime Distribution by Day of Week",
    x = "Day",
    y = "Crime Count",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) +
  theme_minimal()

ggplotly(plot)
```
## Most frequent type of crime
The most frequent type of crime in the dataset is theft from motor vehicle
```{r}
eval = TRUE

crime_data |>
  count(Offense, sort = TRUE) |>
  head(10)
```
## filter the dataset to top 3 crimes
```{r}
eval = TRUE

crime_data |>
  filter(Offense == "Theft From Motor Vehicle" | Offense == "Burglary/Breaking & Entering" | Offense == "Destruction/Damage/Vandalism of Property")

# check which 
```


## Crime Heatmap
```{r}
eval = TRUE

# make sure to uncomment and install the libaries
# install.packages("hexbin")

library(ggplot2)
library(dplyr)
library(hexbin)

# before plotting, filter out invalid coordinates
crime_data <- crime_data |>
  filter(Longitude > -125 & Longitude < -120,
         Latitude > 47 & Latitude < 48)

# Total rows before filtering
total_rows_before <- nrow(read.csv("SPD_Crime_Data__2008-Present_20250228.csv"))

# Total rows after filtering
total_rows_after <- nrow(crime_data)

cat("Rows removed due to invalid coordinates:", total_rows_before - total_rows_after, "\n")

# create the heatmap
# TODO: make the heatmap more vibrant
plot <- crime_data |>
  ggplot(aes(x = Longitude, y = Latitude)) +
  geom_hex(bins = 50) +
  scale_fill_viridis_c(option = "plasma") +
  labs(
    title = "Crime Rate Heatmap in Seattle",
    x = "Longitude",
    y = "Latitude",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) + 
  theme_minimal()

ggplotly(plot)
```
## Here I came up with two questions that I want to answer based on the visualizations:
 - What happened around 2020 since there was a spike? 
 - In the heatmap, where is this area specifically in Seattle?

Here, I wrote some code to determine what happened around 2020
```{r}
eval = TRUE

# filtering data to only include crime in 2020
crime_2020 <- crime_data |>
  filter(year(Report.Date) == 2020)
crime_2020 |>
  glimpse()
```
I wanted to find out which types of crimes increased the most in 2020 and apparently the most frequent crime that occured was burglary
```{r}
eval = TRUE

# top 10 most common crimes in 2020
crime_2020 |>
  count(Offense, sort = TRUE) |>
  head(10)
```

Here, I wanted to determine the crime rates within 2020 every month
```{r}
eval = TRUE

plot <- crime_2020 |>
  mutate(Month = month(Report.Date, label = TRUE)) |>
  count(Month) |>
  ggplot(aes(x = Month, y = n, group = 1)) +
  geom_line(color = "blue") +
  geom_point() +
  labs(
    title = "Crime Rate Spikes in May 2020",
    subtitle = "Monthly Crime Trends in 2020",
    x = "Month",
    y = "Crime Count",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) +
  theme_minimal()

ggplotly(plot)
```
Apparently, there was a spike in May 2020. To check if 2020 had a unique increase, I compared it with previous years.
```{r}
eval = TRUE

plot <- crime_data |>
  mutate(Year = year(Report.Date)) |>
  count(Year) |>
  ggplot(aes(x = Year, y = n)) +
  geom_line(color = "red") +
  geom_point() +
  labs(
    title = "Annual Crime Trends in Seattle (2008 - Present)",
    x = "Year",
    y = "Crime Count",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) +
  theme_minimal()

ggplotly(plot)
```
So I think that there wasn't a unique increase but the trend tells us that crime rates are consistently high. However, in 2025 the trend is low and it's probably because not enough data was collected for that year yet.

I also wanted to check if crime hotspots shifted in 2020 using a heatmap.
```{r}
eval = TRUE

# heatmap 2020
plot1 <- crime_2020 |>
  ggplot(aes(x = Longitude, y = Latitude)) +
  geom_hex(bins = 50) +
  scale_fill_viridis_c(option = "plasma") +
  labs(
    title = "Seattle Crime Heatmap (2020)",
    x = "Longitude",
    y = "Latitude",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) +
  theme_minimal()
ggplotly(plot1)

# heatmap for all years
crime_data <- crime_data |>
  filter(Longitude > -125 & Longitude < -120,
         Latitude > 47 & Latitude < 48)

plot <- crime_data |>
  ggplot(aes(x = Longitude, y = Latitude)) +
  geom_hex(bins = 50) +
  scale_fill_viridis_c(option = "plasma") +
  labs(
    title = "Crime Rate Heatmap in Seattle",
    x = "Longitude",
    y = "Latitude",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
  ) + 
  theme_minimal()

ggplotly(plot)

```

So it seems like in Seattle, there is a particular area that has a high count of crime and it's highlighted in yellow so maybe we can explore more on what that area might be
```{r}
eval = TRUE

# filtering latitude and longitude around the yellow highlighted area
# still trying to find a way to find the locations precisely
particular_area_in_Seattle <- crime_data |>
  filter(Longitude >= -122.35 & Longitude <= -122.3,
         Latitude >= 47.6 & Latitude <= 47.7)
particular_area_in_Seattle |>
  glimpse()
```
Summarizing crime count by location
```{r}
eval = TRUE

library(dplyr)

# Summarize crime count by rounded latitudes and longitudes (to create "zones")
crime_by_location <- particular_area_in_Seattle %>%
  mutate(Location = paste(round(Latitude, 3), round(Longitude, 3), sep = ", ")) %>%
  group_by(Location) %>%
  summarise(Crime_Count = n()) %>%
  arrange(desc(Crime_Count))

# View top 10 locations with the highest crime count 
crime_by_location |> head(10)
```
Visualizing crime distribution
```{r}
eval = TRUE

library(ggplot2)

# Scatter plot of Latitude vs Longitude with color indicating crime density
ggplot(particular_area_in_Seattle, aes(x = Longitude, y = Latitude)) +
  geom_point(aes(color = Crime.Against.Category), alpha = 0.6) +
  labs(
    title = "Crime Distribution where majority of crime is on Property",
    subtitle = "Crime Distribution in Seattle",
    x = "Longitude", 
    y = "Latitude",
    caption = "Data obtained from: https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5/about_data"
    ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```
Determining crime count on every neighborhood
```{r}
eval = TRUE

# Crime count by MCPP (neighborhood)
crime_by_neighborhood <- particular_area_in_Seattle |>
  group_by(MCPP) |>
  summarise(Crime_Count = n()) |>
  arrange(desc(Crime_Count))

# View top neighborhoods
crime_by_neighborhood |> 
  head(10)
```
Summarizing crime count by block address
```{r}
eval = TRUE

# Summarize crime count by block address
crime_by_block <- particular_area_in_Seattle |>
  group_by(X100.Block.Address) |>
  summarise(Crime_Count = n()) |>
  arrange(desc(Crime_Count))

# View top block addresses with the highest crime count
crime_by_block |> 
  head(10)
```

## New Questions to Ask:
- Why was there a spike in May 2020? (protest in May 2020 - George Floyd)
- Why is that particular area in Seattle (Longitude approximately -122.35 to -122.3 and Latitude of 47.6 to 47.7 ) always high in crime count?